---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import LinkButton from "@components/LinkButton.astro";
import Card from "@components/Card";
import Socials from "@components/Socials.astro";
import getSortedPosts from "@utils/getSortedPosts";
import { TbArrowDown } from "react-icons/tb";

const posts = await getCollection("blog");
const sortedPosts = getSortedPosts(posts);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const recentPosts = sortedPosts.filter(({ data }) => !data.featured);
---

<Layout>
  <Header /> 
  
  <main id="main-content" class="pt-32 pb-24">
    
    <!-- SECTION 1: THE MANIFESTO (Hero) -->
    <section class="mb-32 relative">
      <!-- Decorative Top Line -->
      <div class="w-24 h-[1px] bg-skin-base mb-8"></div>
      
      <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
        <div class="lg:col-span-8">
          <h1 class="font-serif text-5xl sm:text-7xl lg:text-8xl leading-[0.9] text-skin-base tracking-tight mb-8">
            Precision <br/>
            <span class="italic text-skin-base/40 font-light">Systems</span> <br/>
            Engineering.
          </h1>
        </div>
        
        <div class="lg:col-span-4 flex flex-col justify-end pb-4">
          <p class="font-mono text-xs uppercase tracking-widest text-skin-base/40 mb-4 border-l border-skin-line/30 pl-4">
             // Status: Active <br/>
             // Loc: Cambridge, UK <br/>
             // Role: Research Asst.
          </p>
          <p class="text-sm sm:text-base font-light leading-relaxed text-skin-base/80 max-w-xs border-l border-skin-line/30 pl-4">
            Shravan Goswami. Building high-performance tools at the intersection of probabilistic programming and open source.
          </p>
          
          <div class="mt-8 pl-4 opacity-60 hover:opacity-100 transition-opacity">
            <Socials />
          </div>
        </div>
      </div>
    </section>


    <!-- SECTION 2: SELECTED TRANSMISSIONS (Featured Work) -->
    {featuredPosts.length > 0 && (
      <section class="mb-32">
        <div class="flex items-end justify-between mb-8 border-b border-skin-line/20 pb-2">
           <h2 class="font-mono text-xs uppercase tracking-widest text-skin-base">Selected Transmissions</h2>
           <span class="font-mono text-[10px] text-skin-base/40">Index 01-0{featuredPosts.length}</span>
        </div>
        
        <div class="flex flex-col">
          {featuredPosts.map(({ data, slug }, index) => (
            <Card
              href={`/blog/${slug}/`}
              frontmatter={data}
              index={index + 1}
              secHeading={false}
            />
          ))}
        </div>

        <div class="mt-8 flex justify-end">
           <LinkButton href="/projects" className="group flex items-center gap-2 text-xs font-mono uppercase tracking-widest text-skin-base/60 hover:text-skin-base transition-colors">
              [ View All Projects ]
           </LinkButton>
        </div>
      </section>
    )}


    <!-- SECTION 3: THE ARCHIVE (Bento-free, Grid-aligned) -->
    <!-- This section uses the "Corner Bracket" utility for a schematic look -->
    <section class="grid grid-cols-1 md:grid-cols-2 gap-12 border-t border-skin-line/20 pt-16">
      
      <!-- Left: Recent Logs -->
      <div class="corner-brackets border border-transparent hover:border-transparent">
        <span class="font-mono text-[10px] uppercase tracking-widest text-skin-base/40 mb-6 block">Raw Log Data</span>
        
        <ul class="space-y-6">
           {recentPosts.slice(0, 3).map(({ data, slug }) => (
             <li>
               <a href={`/blog/${slug}/`} class="group block">
                 <span class="font-mono text-[10px] text-skin-base/30 block mb-1 group-hover:text-skin-accent transition-colors">
                   {data.pubDatetime.toLocaleDateString('en-US', {year: 'numeric', month:'2-digit', day:'2-digit'})}
                 </span>
                 <h4 class="font-serif text-xl text-skin-base group-hover:underline decoration-1 underline-offset-4 decoration-skin-base/30">
                   {data.title}
                 </h4>
               </a>
             </li>
           ))}
        </ul>

        <div class="mt-8">
           <LinkButton href="/blog" className="text-xs font-mono uppercase tracking-widest text-skin-base/40 hover:text-skin-base transition-colors">
             View Full Log &rarr;
           </LinkButton>
        </div>
      </div>

      <!-- Right: Call to Action / CV -->
      <div class="flex flex-col justify-between corner-brackets bg-skin-card-muted/30">
         <div>
            <span class="font-mono text-[10px] uppercase tracking-widest text-skin-base/40 mb-2 block">System Access</span>
            <h3 class="font-serif text-3xl mb-4">Collaboration</h3>
            <p class="text-sm font-light text-skin-base/70 leading-relaxed max-w-sm">
              Open to research collaborations and consulting in high-performance computing and open-science tooling.
            </p>
         </div>

         <div class="flex flex-col gap-4 mt-12">
            <LinkButton href="/resume" className="flex items-center justify-between w-full px-4 py-3 border border-skin-line/40 hover:bg-skin-text-base hover:text-skin-inverted hover:border-skin-text-base transition-all duration-300">
               <span class="text-xs font-mono uppercase tracking-widest">Download CV</span>
               <TbArrowDown className="w-4 h-4" />
            </LinkButton>
            
            <a href="mailto:shravan@example.com" class="text-xs font-mono text-center text-skin-base/40 hover:text-skin-base transition-colors">
              Initiate Contact Protocol
            </a>
         </div>
      </div>

    </section>

  </main>

  <Footer />
</Layout>
