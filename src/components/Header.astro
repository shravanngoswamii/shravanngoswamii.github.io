---
import { SITE } from "@config";
import Search from "./Search.astro";
import { TbMoon, TbSun } from "react-icons/tb";

export interface Props {
  activeNav?: "projects" | "resume" | "blog" | "tags" | "publications";
}

const { activeNav } = Astro.props;
---

<!-- 
  PREMIUM NAVIGATION SYSTEM
  Desktop: Top Floating Pill (Unchanged)
  Mobile: Double-Decker Technical Console (Solves navigability & density)
-->

<!-- DESKTOP HEADER (Hidden on Mobile) -->
<header id="main-header" class="hidden sm:flex fixed top-0 left-0 right-0 z-40 justify-center pointer-events-none transition-transform duration-300">
  <div class="mt-6 pointer-events-auto">
    <div class="
      group relative flex items-center gap-1 p-1.5 pr-3
      rounded-full 
      bg-skin-fill/80 backdrop-blur-xl supports-[backdrop-filter]:bg-skin-fill/60
      border border-skin-line/10 
      shadow-2xl shadow-skin-text-base/5
      transition-all duration-500 ease-out
      hover:scale-[1.01] hover:bg-skin-fill/95 hover:border-skin-line/20 hover:shadow-skin-text-base/10
    ">
      
      <!-- LOGO -->
      <a href="/" class="flex items-center justify-center w-10 h-10 rounded-full bg-skin-card text-skin-base font-serif font-bold text-lg hover:bg-skin-inverted hover:text-skin-inverted transition-colors duration-300 shadow-sm border border-skin-line/10">
        SG
      </a>

      <div class="w-px h-4 bg-skin-line/20 mx-2"></div>

      <!-- NAV LINKS -->
      <nav class="flex items-center">
        <ul class="flex items-center gap-1 text-xs font-mono uppercase tracking-widest font-medium">
          <li><a href="/blog/" class={`px-4 py-2 rounded-full transition-all duration-300 ${activeNav === "blog" ? "bg-skin-inverted text-skin-inverted shadow-md" : "text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted"}`}>Journal</a></li>
          <li><a href="/projects/" class={`px-4 py-2 rounded-full transition-all duration-300 ${activeNav === "projects" ? "bg-skin-inverted text-skin-inverted shadow-md" : "text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted"}`}>Work</a></li>
          <li><a href="/publications/" class={`px-4 py-2 rounded-full transition-all duration-300 ${activeNav === "publications" ? "bg-skin-inverted text-skin-inverted shadow-md" : "text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted"}`}>Research</a></li>
          <li><a href="/resume/" class={`px-4 py-2 rounded-full transition-all duration-300 ${activeNav === "resume" ? "bg-skin-inverted text-skin-inverted shadow-md" : "text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted"}`}>CV</a></li>
        </ul>
      </nav>

      <div class="w-px h-4 bg-skin-line/20 mx-2"></div>

      <!-- UTILITIES -->
      <div class="flex items-center gap-1">
        <div class="scale-90 hover:scale-100 transition-transform"><Search /></div>
        {SITE.lightAndDarkMode && (
            <button id="theme-btn-d" class="flex items-center justify-center w-8 h-8 rounded-full text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted transition-all" aria-label="Toggle theme">
                <TbMoon id="moon-svg-d" className="w-4 h-4" /><TbSun id="sun-svg-d" className="w-4 h-4" />
            </button>
        )}
      </div>
    </div>
  </div>
</header>


<!-- MOBILE: DOUBLE-DECKER CONSOLE -->
<!-- 
  Row 1: Identity & Controls (Fixed height)
  Row 2: Scrollable Navigation Track (Fixed height, horizontally scrollable)
-->
<header id="mobile-header" class="sm:hidden fixed top-0 left-0 right-0 z-50 bg-skin-fill/90 backdrop-blur-xl border-b border-skin-line/10 shadow-lg transition-transform duration-300">
  
  <!-- DECK 1: IDENTITY -->
  <div class="flex items-center justify-between h-14 px-4 border-b border-skin-line/5">
    <a href="/" class="font-serif text-xl font-bold text-skin-base tracking-tighter flex items-center gap-2">
      <span class="w-2 h-2 rounded-full bg-skin-accent animate-pulse"></span>
      SG.
    </a>
    
    <div class="flex items-center gap-3">
       <div class="scale-90 opacity-70"><Search /></div>
       {SITE.lightAndDarkMode && (
         <button id="theme-btn-m" class="p-2 text-skin-base/60 hover:text-skin-base bg-skin-card-muted rounded-md" aria-label="Toggle theme">
            <TbMoon id="moon-svg-m" className="w-4 h-4" />
            <TbSun id="sun-svg-m" className="w-4 h-4" />
         </button>
       )}
    </div>
  </div>

  <!-- DECK 2: PRECISION NAV TRACK -->
  <nav class="h-12 overflow-x-auto overflow-y-hidden" style="scrollbar-width: none; -ms-overflow-style: none;">
    <ul class="flex items-center h-full px-4 min-w-max text-xs font-mono uppercase tracking-widest">
       
       <!-- Item 1 -->
       <li>
         <a href="/blog/" class={`flex items-center h-8 px-4 rounded-sm transition-all ${activeNav === "blog" ? "bg-skin-inverted text-skin-inverted font-bold" : "text-skin-base/60"}`}>
           Journal
         </a>
       </li>
       <li class="mx-2 text-skin-line/30">|</li>
       
       <!-- Item 2 -->
       <li>
         <a href="/projects/" class={`flex items-center h-8 px-4 rounded-sm transition-all ${activeNav === "projects" ? "bg-skin-inverted text-skin-inverted font-bold" : "text-skin-base/60"}`}>
           Work
         </a>
       </li>
       <li class="mx-2 text-skin-line/30">|</li>

       <!-- Item 3 -->
       <li>
         <a href="/publications/" class={`flex items-center h-8 px-4 rounded-sm transition-all ${activeNav === "publications" ? "bg-skin-inverted text-skin-inverted font-bold" : "text-skin-base/60"}`}>
           Research
         </a>
       </li>
       <li class="mx-2 text-skin-line/30">|</li>

       <!-- Item 4 -->
       <li>
         <a href="/resume/" class={`flex items-center h-8 px-4 rounded-sm transition-all ${activeNav === "resume" ? "bg-skin-inverted text-skin-inverted font-bold" : "text-skin-base/60"}`}>
           CV
         </a>
       </li>
       
       <!-- End Padding to prevent cut-off -->
       <li class="w-4"></li>
    </ul>
  </nav>

</header>

<script>
  function setupThemeToggle() {
    const handleThemeClick = () => {
      const html = document.documentElement;
      const currentTheme = html.getAttribute("data-theme");
      const nextTheme = currentTheme === "dark" ? "light" : "dark";

      html.classList.add("theme-transition");
      html.setAttribute("data-theme", nextTheme);
      localStorage.setItem("theme", nextTheme);

      setTimeout(() => html.classList.remove("theme-transition"), 350);
    };

    document.querySelector("#theme-btn-d")?.addEventListener("click", handleThemeClick);
    document.querySelector("#theme-btn-m")?.addEventListener("click", handleThemeClick);
  }

  setupThemeToggle();
  document.addEventListener("astro:after-swap", setupThemeToggle);
</script>

<script>
  function setupScrollNav() {
    const desktop = document.querySelector("#main-header") as HTMLElement;
    const mobile = document.querySelector("#mobile-header") as HTMLElement;
    let lastY = window.scrollY;
    let ticking = false;

    function onScroll() {
      const y = window.scrollY;
      const down = y > lastY && y > 80;
      lastY = y;

      if (down) {
        desktop?.style.setProperty("transform", "translateY(-100%)");
        mobile?.style.setProperty("transform", "translateY(-100%)");
      } else {
        desktop?.style.setProperty("transform", "translateY(0)");
        mobile?.style.setProperty("transform", "translateY(0)");
      }
      ticking = false;
    }

    window.addEventListener("scroll", () => {
      if (!ticking) {
        requestAnimationFrame(onScroll);
        ticking = true;
      }
    }, { passive: true });
  }

  setupScrollNav();
  document.addEventListener("astro:after-swap", setupScrollNav);
</script>
