---
import { SITE } from "@config";
import Search from "./Search.astro";
import { TbMenu2, TbX, TbMoon, TbSun } from "react-icons/tb";

export interface Props {
  activeNav?: "projects" | "resume" | "blog" | "tags" | "publications";
}

const { activeNav } = Astro.props;
---

<!-- 
  PREMIUM LAYOUT STRATEGY: 
  1. Mobile: A sturdy, full-width glass header for usability.
  2. Desktop: A "Floating Command Console" (Pill shape) centered at the top.
-->

<!-- WRAPPER: Fixed, high z-index, allows clicks to pass through empty areas -->
<header class="fixed top-0 left-0 right-0 z-40 flex flex-col items-center pointer-events-none transition-all duration-300">
  
  <!-- DESKTOP: FLOATING CONSOLE (Hidden on mobile) -->
  <div class="hidden sm:flex mt-6 pointer-events-auto">
    <div class="
      group relative flex items-center gap-1 p-1.5 pr-3
      rounded-full 
      bg-skin-fill/70 backdrop-blur-xl supports-[backdrop-filter]:bg-skin-fill/60
      border border-skin-line/10 
      shadow-2xl shadow-skin-text-base/5
      transition-all duration-500 ease-out
      hover:scale-[1.01] hover:bg-skin-fill/90 hover:border-skin-line/20 hover:shadow-skin-text-base/10
    ">
      
      <!-- LOGO: Circular Anchor -->
      <a href="/" class="flex items-center justify-center w-10 h-10 rounded-full bg-skin-card text-skin-base font-serif font-bold text-lg hover:bg-skin-text-base hover:text-skin-inverted transition-colors duration-300 shadow-sm border border-skin-line/10" aria-label="Home">
        SG
      </a>

      <!-- SEPARATOR -->
      <div class="w-px h-4 bg-skin-line/20 mx-2"></div>

      <!-- NAV LINKS -->
      <nav class="flex items-center">
        <ul class="flex items-center gap-1 text-xs font-mono uppercase tracking-widest font-medium">
          <li>
            <a href="/blog/" class={`
              px-4 py-2 rounded-full transition-all duration-300
              ${activeNav === "blog" 
                ? "bg-skin-text-base text-skin-inverted shadow-md" 
                : "text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted"}
            `}>
              Journal
            </a>
          </li>
          <li>
            <a href="/projects/" class={`
              px-4 py-2 rounded-full transition-all duration-300
              ${activeNav === "projects" 
                ? "bg-skin-text-base text-skin-inverted shadow-md" 
                : "text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted"}
            `}>
              Work
            </a>
          </li>
          <li>
            <a href="/publications/" class={`
              px-4 py-2 rounded-full transition-all duration-300
              ${activeNav === "publications" 
                ? "bg-skin-text-base text-skin-inverted shadow-md" 
                : "text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted"}
            `}>
              Research
            </a>
          </li>
        </ul>
      </nav>

      <!-- SEPARATOR -->
      <div class="w-px h-4 bg-skin-line/20 mx-2"></div>

      <!-- UTILITIES -->
      <div class="flex items-center gap-1">
        <div class="scale-90 hover:scale-100 transition-transform">
           <Search />
        </div>
        
        {
          SITE.lightAndDarkMode && (
            <div class="relative group/theme ml-1">
              <button
                id="theme-btn"
                class="flex items-center justify-center w-8 h-8 rounded-full text-skin-base/60 hover:text-skin-base hover:bg-skin-card-muted transition-all"
                title="Toggle theme"
                aria-label="auto"
              >
                <TbMoon id="moon-svg" className="w-4 h-4" />
                <TbSun id="sun-svg" className="w-4 h-4" />
              </button>
              
              <!-- Floating Theme Menu -->
              <div
                id="theme-dropdown"
                class="absolute right-0 top-full mt-4 w-32 p-1 rounded-xl bg-skin-fill/95 backdrop-blur-md border border-skin-line/10 shadow-xl hidden group-hover/theme:block hover:block origin-top-right transition-all"
              >
                <button class="theme-option w-full text-left px-3 py-2 text-[10px] font-mono uppercase tracking-widest rounded-lg hover:bg-skin-text-base hover:text-skin-inverted transition-colors" data-theme="light">Light</button>
                <button class="theme-option w-full text-left px-3 py-2 text-[10px] font-mono uppercase tracking-widest rounded-lg hover:bg-skin-text-base hover:text-skin-inverted transition-colors" data-theme="dark">Dark</button>
                <button class="theme-option w-full text-left px-3 py-2 text-[10px] font-mono uppercase tracking-widest rounded-lg hover:bg-skin-text-base hover:text-skin-inverted transition-colors" data-theme="auto">Auto</button>
              </div>
            </div>
          )
        }
      </div>
    </div>
  </div>

  <!-- MOBILE: FULL WIDTH BLUR HEADER (Pointer events auto to catch clicks) -->
  <div class="sm:hidden w-full h-16 pointer-events-auto bg-skin-fill/85 backdrop-blur-md border-b border-skin-line/10 flex items-center justify-between px-4">
    <a href="/" class="font-serif text-lg font-bold text-skin-base">
      SG.
    </a>

    <button
      class="hamburger-menu p-2 text-skin-base hover:bg-skin-card-muted rounded-md transition-colors"
      aria-label="Open Menu"
      aria-expanded="false"
      aria-controls="menu-items"
    >
      <TbMenu2 className="menu-open w-6 h-6" />
      <TbX className="menu-close w-6 h-6 hidden" />
    </button>
  </div>
  
  <!-- MOBILE MENU OVERLAY -->
  <div id="menu-items" class="display-none fixed inset-0 top-16 bg-skin-fill z-30 p-8 sm:hidden pointer-events-auto flex flex-col gap-8 overflow-y-auto">
    <nav>
      <ul class="flex flex-col gap-6 text-2xl font-serif text-skin-base">
        <li><a href="/blog/" class="block border-b border-skin-line/10 pb-2">Journal</a></li>
        <li><a href="/projects/" class="block border-b border-skin-line/10 pb-2">Work</a></li>
        <li><a href="/publications/" class="block border-b border-skin-line/10 pb-2">Research</a></li>
        <li><a href="/resume/" class="block border-b border-skin-line/10 pb-2">CV</a></li>
      </ul>
    </nav>
    
    <div class="mt-auto pt-8 border-t border-skin-line/20 flex items-center justify-between">
       <span class="text-xs font-mono uppercase tracking-widest opacity-50">Preferences</span>
       <!-- Theme Toggle Mobile Logic handled by script below -->
    </div>
  </div>
</header>

<script>
  function toggleNav() {
    const menuBtn = document.querySelector(".hamburger-menu");
    const menuOpen = document.querySelector(".menu-open");
    const menuClose = document.querySelector(".menu-close");
    const menuItems = document.querySelector("#menu-items");

    menuBtn?.addEventListener("click", () => {
      const isExpanded = menuBtn.getAttribute("aria-expanded") === "true";
      menuBtn.setAttribute("aria-expanded", isExpanded ? "false" : "true");
      menuBtn.setAttribute("aria-label", isExpanded ? "Open Menu" : "Close Menu");
      
      menuOpen?.classList.toggle("hidden");
      menuClose?.classList.toggle("hidden");
      menuItems?.classList.toggle("display-none");
      
      document.body.style.overflow = isExpanded ? "auto" : "hidden";
    });
  }

  toggleNav();
  document.addEventListener("astro:after-swap", toggleNav);
</script>
