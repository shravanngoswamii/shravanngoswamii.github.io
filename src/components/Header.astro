---
import { SITE } from "@config";
import Search from "./Search.astro";
import { TbMenu2, TbX, TbMoon, TbSun } from "react-icons/tb";

export interface Props {
  activeNav?: "projects" | "resume" | "blog" | "tags" | "publications";
}

const { activeNav } = Astro.props;
---

<header class="fixed top-0 z-40 w-full transition-all duration-300 glass" id="main-header">
  <div class="mx-auto flex max-w-6xl items-center justify-between p-4 sm:px-8 h-16">
    
    <!-- Logo -->
    <a href="/" class="group flex items-center gap-2">
       <span class="font-serif text-xl font-bold tracking-tight text-skin-base group-hover:text-skin-accent transition-colors duration-500">
         SG.
       </span>
    </a>

    <!-- Navigation -->
    <nav class="hidden sm:flex items-center gap-8">
      <ul class="flex items-center gap-6 text-sm font-medium tracking-wide">
        <li>
          <a href="/blog/" class={`hover:text-skin-accent transition-colors ${activeNav === "blog" ? "text-skin-accent border-b border-skin-accent/50" : "text-skin-base/70"}`}>
            Journal
          </a>
        </li>
        <li>
          <a href="/projects/" class={`hover:text-skin-accent transition-colors ${activeNav === "projects" ? "text-skin-accent border-b border-skin-accent/50" : "text-skin-base/70"}`}>
            Work
          </a>
        </li>
        <li>
          <a href="/publications/" class={`hover:text-skin-accent transition-colors ${activeNav === "publications" ? "text-skin-accent border-b border-skin-accent/50" : "text-skin-base/70"}`}>
            Research
          </a>
        </li>
        <li>
          <a href="/resume/" class={`hover:text-skin-accent transition-colors ${activeNav === "resume" ? "text-skin-accent border-b border-skin-accent/50" : "text-skin-base/70"}`}>
            CV
          </a>
        </li>
      </ul>

      <div class="w-[1px] h-4 bg-skin-line/50"></div>

      <div class="flex items-center gap-2">
        <Search />
        
        {
          SITE.lightAndDarkMode && (
            <div class="relative group/theme">
              <button
                id="theme-btn"
                class="p-2 opacity-60 hover:opacity-100 hover:text-skin-accent transition-all"
                title="Toggle theme"
                aria-label="auto"
              >
                <TbMoon id="moon-svg" className="w-4 h-4" />
                <TbSun id="sun-svg" className="w-4 h-4" />
              </button>
              
              {/* Minimalist Theme Dropdown */}
              <div
                id="theme-dropdown"
                class="absolute right-0 top-full mt-4 w-32 py-2 rounded-sm bg-skin-card border border-skin-line shadow-xl hidden group-hover/theme:block hover:block"
              >
                <button class="theme-option w-full text-left px-4 py-2 text-xs uppercase tracking-wider hover:bg-skin-fill hover:text-skin-accent" data-theme="light">Light</button>
                <button class="theme-option w-full text-left px-4 py-2 text-xs uppercase tracking-wider hover:bg-skin-fill hover:text-skin-accent" data-theme="dark">Dark</button>
                <div class="border-t border-skin-line/10 my-1"></div>
                <button class="theme-option w-full text-left px-4 py-2 text-xs uppercase tracking-wider hover:bg-skin-fill hover:text-skin-accent" data-theme="auto">Auto</button>
              </div>
            </div>
          )
        }
      </div>
    </nav>

    <!-- Mobile Menu Button -->
    <button
      class="hamburger-menu sm:hidden p-2 text-skin-base hover:text-skin-accent"
      aria-label="Open Menu"
      aria-expanded="false"
      aria-controls="menu-items"
    >
      <TbMenu2 className="menu-open w-6 h-6" />
      <TbX className="menu-close w-6 h-6 hidden" />
    </button>
  </div>
  
  <!-- Mobile Menu Overlay -->
  <div id="menu-items" class="display-none fixed inset-0 top-16 bg-skin-fill z-30 p-8 sm:hidden">
    <ul class="flex flex-col gap-6 text-xl font-serif">
      <li><a href="/blog/">Journal</a></li>
      <li><a href="/projects/">Work</a></li>
      <li><a href="/publications/">Research</a></li>
      <li><a href="/resume/">CV</a></li>
    </ul>
  </div>
</header>

<script>
  function toggleNav() {
    const menuBtn = document.querySelector(".hamburger-menu");
    const menuOpen = document.querySelector(".menu-open");
    const menuClose = document.querySelector(".menu-close");
    const menuItems = document.querySelector("#menu-items");

    menuBtn?.addEventListener("click", () => {
      const isExpanded = menuBtn.getAttribute("aria-expanded") === "true";
      menuBtn.setAttribute("aria-expanded", isExpanded ? "false" : "true");
      menuBtn.setAttribute("aria-label", isExpanded ? "Open Menu" : "Close Menu");
      
      menuOpen?.classList.toggle("hidden");
      menuClose?.classList.toggle("hidden");
      menuItems?.classList.toggle("display-none");
      
      // Prevent scrolling when menu is open
      document.body.style.overflow = isExpanded ? "auto" : "hidden";
    });
  }

  toggleNav();
  document.addEventListener("astro:after-swap", toggleNav);
</script>
